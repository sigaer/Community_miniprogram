{"version":3,"sources":["uni-app:///main.js","webpack:///D:/code/uniapp/Old-service/packageChat/pages/chatroom/chatroom.vue?3d66","webpack:///D:/code/uniapp/Old-service/packageChat/pages/chatroom/chatroom.vue?74df","webpack:///D:/code/uniapp/Old-service/packageChat/pages/chatroom/chatroom.vue?f20e","webpack:///D:/code/uniapp/Old-service/packageChat/pages/chatroom/chatroom.vue?d546","uni-app:///packageChat/pages/chatroom/chatroom.vue","webpack:///D:/code/uniapp/Old-service/packageChat/pages/chatroom/chatroom.vue?d762","webpack:///D:/code/uniapp/Old-service/packageChat/pages/chatroom/chatroom.vue?b655"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","data","baseUrl","recordOption","duration","sampleRate","numberOfChannels","encodeBitRate","format","newmsg","name","avatar","openid","uid","chatlist","member","animationData","bb","bg","users","userlist","otochat","scrollTop","style","contentH","itemH","socketOpen","socket","inputMode","imgPath","recorderManager","recordStart","recordEnd","audioManager","chatStyle","isShow","expressions","touchT","touchE","onLoad","console","uni","icon","title","uniCloud","cloudPath","filePath","onUploadProgress","success","type","record","username","createdAt","sender","msg","event","roomid","content","url","fail","socketTask","value","chat","cacheChatlist","onUnload","onReady","methods","toggleShow","touchstart","touchend","recordToText","method","chooseMedia","count","sizeType","mediaType","sourceType","camera","pickerEmoji","pageToBottom","fields","size","exec","sendMsg","err","onemsg","resendMsg","recordMsg","sendRecordMsg","playRecord","previewImage","urls","current","showmenu","textHandler","emojiMap","receiveMsg","changeMode"],"mappings":";;;;;;;;;;;;;AAAA;AAE2D;AAC3D;AACA;AAHA;AACAA,EAAE,CAACC,iCAAiC,GAAGC,mBAAmB;AAG1DC,UAAU,CAACC,iBAAI,CAAC,C;;;;;;;;;;;;;ACLhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAiI;AACjI;AAC4D;AACL;AACsC;;;AAG7F;AAC6M;AAC7M,gBAAgB,iNAAU;AAC1B,EAAE,8EAAM;AACR,EAAE,+FAAM;AACR,EAAE,wGAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,mGAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA,aAAa,2RAEN;AACP,KAAK;AACL;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAU,mBAAO,CAAC,qCAA4B;AAC9C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAU,mBAAO,CAAC,qCAA4B;AAC9C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA,MAAM;AACN;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACtFA;AAAA;AAAA;AAAA;AAAuzB,CAAgB,syBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;AC4E30B;AACA;AAAA;AAAA;AAAA,eACA;EACAC;IACA;MACAC;MACAC;QACAC;QACAC;QACAC;QACAC;QACAC;MACA;MACAC;MAAA;MACAC;MAAA;MACAC;MAAA;MACAC;MAAA;MACA;MACA;MACAC;MACAC;MAAA;MACAC;MAAA;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;QACAC;QACAC;MACA;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;IACA;EACA;EACAC;IAAA;IACAC;IACAA;IACA;IACA;IACA;MACAA;MACAA;MACAA;MACA;QACAC;UACAC;UACAC;QACA;QACA;MACA;MACAC;QACAC;QACAC;QACAC;UACAP;UACA;UACAA;QACA;QACAQ;UACAR;UACA;UACAA;UACA;YACAS;YACA7C;YACA8C;YACAzC;YACA0C;YACAxC;YACAyC;YACAC;UACA;UACA;YACAH;YACAI;YACAF;YACAC;UACA;UACA;UACAb;UACA;UACA;UACAA;UACA;YACAC;cACAxC;gBACAsD;gBACAtD;kBACAuD;kBACAC;oBACAR;kBAAA,GACAhD;gBAEA;cACA;cACA+C;gBACAR;gBACA;cACA;YACA;UACA;YACA;UAAA;QAEA;MACA;MACAA;IACA;IACA;IACA;MACAC;QACAC;QACAC;MACA;MACA;IACA;IACA;MAAAQ;MAAAxC;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;MACA+C;MAAA;MACAV;QACAR;MACA;MACAmB;QACAnB;MACA;IACA;;IAEA;IACAoB;MACApB;MACA;MACA;MACA;MACAC;QACAxC;UACAsD;UACAtD;YACAwD;cACAR;cACAK;YACA;UACA;QACA;MACA;IACA;IACA;IACAM;MACA;MACApB;MACA;QACA;QACA;UACA;YACA7B;YACAwC;UAAA,GACAU,iBACA;UACAC;UACA;UACA;QACA;QACA;QACAC;UACA;YACA;UACA;UACA;QACA;QACA;UAAA;QAAA;MACA;QACA;QACA;UAAA;QAAA;QACAT;QACA;QACA;UACAA;UACAA;QACA;UACAA;UACAA;QACA;QACAd;QACA;MACA;MACA;IACA;;IAEA;IACAoB;MACApB;MACAA;MACAC;IACA;;IAEA;IACAmB;MACApB;MACAC;QACAC;QACAC;MACA;IACA;EACA;EACAqB;IACAvB;MACAO;QACAR;MACA;IACA;EACA;EACAyB;IACA;IACA;MACA;MACA;IACA;MACAzB;IACA;IACA;EACA;EACA0B;IACAC;MACA;MACA3B;MACAA;IACA;IACA4B;MACA;IACA;IACAC;MACA;IACA;IACAC;MAAA;MACA;MACA;MACA;MACAhB;MACAA;MACA;QACA;UACAI;UACAa;UACAtE;YACAyD;UACA;QACA,QACA;UACAlB;UACAc;UACA;QACA,GACA;UACAb;YACAC;YACAC;UACA;QACA,EACA;MACA;IACA;IACA6B;MAAA;MACA/B;QACAgC;QACAC;QACAC;QACAC;QACAC;QACA;QACA7B;UACAR;UACAA;UACAI;YACAC;YACAC;YACAE;cACA;cACAR;cACAA;cACA;gBACAS;gBACAxC;gBACA0C;gBACAxC;gBACAyC;gBACAC;cACA;cACA;gBACAJ;gBACAK;gBACAF;gBACAC;cACA;cACA;cACAb;cACA;cACAA;cACA;gBACAC;kBACAxC;oBACAsD;oBACAtD;sBACAuD;sBACAC;oBACA;kBACA;kBACAT;oBACAR;oBACA;kBACA;gBACA;cACA;gBACA;cAAA;YAEA;UACA;QACA;MACA;IACA;IACAsC;MACA;IACA;IACAC;MAAA;MAAA;MACA;MACA;MACA;QACAtD,MACAuD,OACA;UACAC;QACA,GACA;UACA;YACA;cACA;gBACA;cACA;YACA;cACA;YACA;YACA;UACA;QACA,EACA,CACAC;MACA;IACA;IAEA;IACAC;MAAA;MACA;MACA;QACA;QACA;UACAlC;UACAxC;UACA0C;UACAxC;UACAyC;UACAC;QACA;QACA;UACAC;UACAF;UACAC;QACA;QACA;UACA;QACA;UACA;YACA+B;UAAA,GACAC,QACA;QACA;QACA7C;QACA;QACA;QACAA;QACA;UACAC;YACAxC;cACAsD;cACAtD;gBACAuD;gBACAC;kBACAR;gBAAA,GACAhD;cAEA;YACA;YACA+C;cACAR;cACA;YACA;UACA;QACA;MACA;IACA;IACA8C;MAAA;MACA;QACAhC;QACAF;QACAC;MACA;MACA;MACA;QACA;UAAA;QAAA;QACA;QACA;QACA;QACAZ;UACAxC;YACAsD;YACAtD;cACAuD;cACAC;gBACAR;cAAA,GACAhD;YAEA;UACA;UACA+C;YACA;YACAR;YACA;UACA;QACA;MACA;QACAC;UACAC;UACAC;QACA;MACA;IACA;IACA4C;MACA/C;MACA;MACA;MACA;MACAA;IACA;IACAgD;MACA;MACA;MACA;IACA;IACAC;MACAjD;MACAA;MACA;QACA;QACA;QACA;QACA;MACA;MACA;QACA;QACA;MACA;IACA;IACAkD;MACAlD;MACAC;QACAkD;QACAC;QACAC;QACA7C;UACAR;QACA;MACA;IACA;IACAsD;MAAA;MACA;MACA;MACAtD;MACA;QAAA/B;MACA;QACA;UACA;UACA;UACA2B;YACA2D;UACA;UACAvD;UACA;UACA,cACA,qDACA/B;YAAA;UAAA,KACA;UACA;UACA;UACA;UACA+B;UACA;QACA;UACA;QACA;MACA;IACA;IACA;IACAwD;MAAA;MACA;MACA;QACA;QACA;MACA;IACA;IACAC;MACA;MACA;IACA;EACA;AACA;AAAA,2B;;;;;;;;;;;;;ACrmBA;AAAA;AAAA;AAAA;AAAkiD,CAAgB,67CAAG,EAAC,C;;;;;;;;;;;ACAtjD;AACA,OAAO,KAAU,EAAE,kBAKd","file":"packageChat/pages/chatroom/chatroom.js","sourcesContent":["import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;import '@dcloudio/vue-cli-plugin-uni/packages/uni-cloud/dist/index.js';\nimport Vue from 'vue'\nimport Page from './packageChat/pages/chatroom/chatroom.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./chatroom.vue?vue&type=template&id=6981a9d6&scoped=true&\"\nvar renderjs\nimport script from \"./chatroom.vue?vue&type=script&lang=js&\"\nexport * from \"./chatroom.vue?vue&type=script&lang=js&\"\nimport style0 from \"./chatroom.vue?vue&type=style&index=0&id=6981a9d6&scoped=true&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../Tools/HBuilderX.3.3.5.20211229.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"6981a9d6\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"packageChat/pages/chatroom/chatroom.vue\"\nexport default component.exports","export * from \"-!../../../../../../Tools/HBuilderX.3.3.5.20211229.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../Tools/HBuilderX.3.3.5.20211229.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--17-0!../../../../../../Tools/HBuilderX.3.3.5.20211229.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../Tools/HBuilderX.3.3.5.20211229.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../Tools/HBuilderX.3.3.5.20211229.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Tools/HBuilderX.3.3.5.20211229.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chatroom.vue?vue&type=template&id=6981a9d6&scoped=true&\"","var components\ntry {\n  components = {\n    zeroLoading: function () {\n      return import(\n        /* webpackChunkName: \"uni_modules/zero-loading/components/zero-loading/zero-loading\" */ \"@/uni_modules/zero-loading/components/zero-loading/zero-loading.vue\"\n      )\n    },\n  }\n} catch (e) {\n  if (\n    e.message.indexOf(\"Cannot find module\") !== -1 &&\n    e.message.indexOf(\".vue\") !== -1\n  ) {\n    console.error(e.message)\n    console.error(\"1. 排查组件名称拼写是否正确\")\n    console.error(\n      \"2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom\"\n    )\n    console.error(\n      \"3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件\"\n    )\n  } else {\n    throw e\n  }\n}\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var l0 = _vm.__map(_vm.chatlist, function (e, index) {\n    var $orig = _vm.__get_orig(e)\n    var m0 =\n      e.sender != _vm.openid &&\n      e.sender != \"system\" &&\n      !(e.type === \"image\") &&\n      !(e.type === \"video\") &&\n      e.type == \"message\"\n        ? _vm.textHandler(e)\n        : null\n    var m1 =\n      e.sender != _vm.openid && e.sender != \"system\" && e.type == \"record\"\n        ? require(\"../../static/recordMsg.png\")\n        : null\n    var m2 =\n      e.sender != _vm.openid && e.sender != \"system\"\n        ? _vm.timeFormat(e.createdAt)\n        : null\n    var m3 =\n      !(e.sender != _vm.openid && e.sender != \"system\") &&\n      e.sender == _vm.openid &&\n      e.type == \"message\"\n        ? _vm.textHandler(e)\n        : null\n    var m4 =\n      !(e.sender != _vm.openid && e.sender != \"system\") &&\n      e.sender == _vm.openid &&\n      e.type == \"record\"\n        ? require(\"../../static/recordMsg.png\")\n        : null\n    var m5 =\n      !(e.sender != _vm.openid && e.sender != \"system\") &&\n      e.sender == _vm.openid\n        ? _vm.timeFormat(e.createdAt)\n        : null\n    return {\n      $orig: $orig,\n      m0: m0,\n      m1: m1,\n      m2: m2,\n      m3: m3,\n      m4: m4,\n      m5: m5,\n    }\n  })\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        l0: l0,\n      },\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../Tools/HBuilderX.3.3.5.20211229.full/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../Tools/HBuilderX.3.3.5.20211229.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../../Tools/HBuilderX.3.3.5.20211229.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../Tools/HBuilderX.3.3.5.20211229.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Tools/HBuilderX.3.3.5.20211229.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chatroom.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../Tools/HBuilderX.3.3.5.20211229.full/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../Tools/HBuilderX.3.3.5.20211229.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../../Tools/HBuilderX.3.3.5.20211229.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../Tools/HBuilderX.3.3.5.20211229.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Tools/HBuilderX.3.3.5.20211229.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chatroom.vue?vue&type=script&lang=js&\"","<template>\r\n\t<view>\r\n\t\t<!-- 聊天列表 -->\r\n\t\t<view class=\"main\">\r\n\t\t\t<scroll-view id=\"scrollview\" scroll-y :scroll-top=\"scrollTop\" :scroll-with-animation=\"true\" :style=\"{ height: style.contentH + 25 + 'px' }\">\r\n\t\t\t\t<view v-for=\"(e, index) in chatlist\" :key=\"index\" class=\"chat-item\">\r\n\t\t\t\t\t<view class=\"left msg\" v-if=\"e.sender != openid && e.sender != 'system'\">\r\n\t\t\t\t\t\t<image :src=\"e.avatar\" class=\"avatar\"></image>\r\n\t\t\t\t\t\t<view class=\"nr\" @click=\"playRecord(e)\">\r\n\t\t\t\t\t\t\t<view class=\"newmsg\">\r\n\t\t\t\t\t\t\t\t<img :src=\"e.newmsg\" v-if=\"e.type === 'image'\" mode=\"aspectFill\" style=\"max-height:150rpx\" />\r\n\t\t\t\t\t\t\t\t<video :src=\"e.newmsg\" v-else-if=\"e.type === 'video'\"></video>\r\n\t\t\t\t\t\t\t\t<rich-text :nodes=\"textHandler(e)\" v-else-if=\"e.type == 'message'\"></rich-text>\r\n\t\t\t\t\t\t\t\t<!-- \t\t\t\t\t\t\t\t<view v-html=\"textHandler(e)\"></view> -->\r\n\t\t\t\t\t\t\t\t<text v-else-if=\"e.type == 'record'\" @longpress=\"recordToText(e)\">{{ e.newmsg + '\" ' }}</text>\r\n\t\t\t\t\t\t\t\t<img src=\"../../static/recordMsg.png\" mode=\"aspectFit\" v-if=\"e.type == 'record'\" style=\"width:28rpx;height:28rpx;\" />\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t<view class=\"nt\">{{ e.username }} {{ timeFormat(e.createdAt) }}</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class=\"right msg\" v-else-if=\"e.sender == openid\">\r\n\t\t\t\t\t\t<image :src=\"e.avatar\" class=\"avatar\"></image>\r\n\t\t\t\t\t\t<view class=\"nr\">\r\n\t\t\t\t\t\t\t<view class=\"newmsg\" @click=\"playRecord(e)\" @touchstart=\"touchstart\" @touchend=\"touchend\" @longpress=\"recordToText(index)\">\r\n\t\t\t\t\t\t\t\t<img :src=\"e.newmsg\" v-if=\"e.type === 'image'\" mode=\"aspectFill\" style=\"max-height:150rpx\" @click=\"previewImage(e.newmsg)\" />\r\n\t\t\t\t\t\t\t\t<video :src=\"e.newmsg\" v-if=\"e.type === 'video'\" autoplay controls></video>\r\n\t\t\t\t\t\t\t\t<rich-text :nodes=\"textHandler(e)\" v-if=\"e.type == 'message'\"></rich-text>\r\n\t\t\t\t\t\t\t\t<!-- \t\t\t\t\t\t\t\t<view v-html=\"textHandler(e)\"></view> -->\r\n\t\t\t\t\t\t\t\t<text v-if=\"e.type == 'record'\" style=\"padding-right:0.2rem\">{{ e.newmsg + '\"' }}</text>\r\n\t\t\t\t\t\t\t\t<img src=\"../../static/recordMsg.png\" mode=\"aspectFit\" v-if=\"e.type == 'record'\" style=\"width:28rpx;height:28rpx;\" />\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t<view class=\"nt\">{{ e.username }} {{ timeFormat(e.createdAt) }}</view>\r\n\t\t\t\t\t\t\t<view class=\"transferView\" v-if=\"e.type === 'record' && e.showMenu\">\r\n\t\t\t\t\t\t\t\t<zero-loading type=\"pulse\" position=\"absolute\" v-if=\"e.transferText === undefined\"></zero-loading>\r\n\t\t\t\t\t\t\t\t<text v-else>{{e.transferText}}</text>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t</view>\r\n\r\n\t\t\t\t\t\t<image src=\"/static/warning.png\" style=\"width:48rpx;height:48rpx;align-self: center;margin-right:10rpx;\" @click=\"resendMsg(e)\" v-if=\"e.err\"></image>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class=\"center\" v-else>\r\n\t\t\t\t\t\t<view class=\"inner\">{{ e.name }}</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</scroll-view>\r\n\t\t</view>\r\n\t\t<view class=\"send\">\r\n\t\t\t<image :src=\"imgPath\" mode=\"aspectFit\" @tap=\"changeMode\" style=\"margin-left:16rpx\"></image>\r\n\t\t\t<textarea\r\n\t\t\t\ttype=\"text\"\r\n\t\t\t\tconfirm-type=\"send\"\r\n\t\t\t\tclass=\"chat-send\"\r\n\t\t\t\tv-model=\"newmsg\"\r\n\t\t\t\tauto-height=\"true\"\r\n\t\t\t\tshow-confirm-bar=\"false\"\r\n\t\t\t\tmaxlength=\"-1\"\r\n\t\t\t\tv-if=\"inputMode == 'text'\"\r\n\t\t\t\tstyle=\"text-align:left\"\r\n\t\t\t/>\r\n\t\t\t<view :class=\"chatStyle\" @longpress=\"recordMsg($event)\" @touchend=\"sendRecordMsg\" v-else>按住 说话</view>\r\n\t\t\t<image src=\"/static/default/image.png\" mode=\"aspectFit\" @click=\"chooseMedia\" style=\"margin-right:16rpx\"></image>\r\n\t\t\t<image src=\"/static/default/smile.png\" mode=\"aspectFit\" @click=\"toggleShow\" style=\"margin-right:16rpx\"></image>\r\n\t\t\t<image src=\"../../static/send.png\" mode=\"aspectFit\" @tap=\"sendMsg\" style=\"margin-right:16rpx\"></image>\r\n\t\t\t<view class=\"emoji-panel\" v-if=\"isShow\">\r\n\t\t\t\t<!-- <ul class=\"emoji-list\">\r\n\t\t\t\t\t<li class=\"emoji-item\" v-for=\"(item, i) in expressions\" :key=\"i\" @click.stop=\"pickerEmoji(item)\"> -->\r\n\t\t\t\t<image :src=\"baseUrl + item.url\" :alt=\"item.title\" :title=\"item.title\" v-for=\"(item, i) in expressions\" :key=\"i\" @click.stop=\"pickerEmoji(item)\" />\r\n\t\t\t\t<!-- \t\t\t\t\t</li>\r\n\t\t\t\t</ul> -->\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<view class=\"bg\" @tap=\"outotoChat\" :style=\"{ display: bg }\"></view>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\nimport { expressions } from '../../utils/emoji.js';\r\nimport { EMOJI_BASE_URL } from '../../utils/config.js';\r\nexport default {\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\tbaseUrl: EMOJI_BASE_URL,\r\n\t\t\trecordOption: {\r\n\t\t\t\tduration: 60000,\r\n\t\t\t\tsampleRate: 16000,\r\n\t\t\t\tnumberOfChannels: 1,\r\n\t\t\t\tencodeBitRate: 96000,\r\n\t\t\t\tformat: 'mp3'\r\n\t\t\t},\r\n\t\t\tnewmsg: '', //消息内容\r\n\t\t\tname: '', //用户名称\r\n\t\t\tavatar: '', //用户头像\r\n\t\t\topenid: '', //用户id\r\n\t\t\t// uname: '',\r\n\t\t\t// fid: '',\r\n\t\t\tuid: 'a',\r\n\t\t\tchatlist: [], //聊天内容\r\n\t\t\tmember: 0, //成员个数\r\n\t\t\tanimationData: {},\r\n\t\t\tbb: false,\r\n\t\t\tbg: 'none',\r\n\t\t\tusers: '',\r\n\t\t\tuserlist: [],\r\n\t\t\totochat: [],\r\n\t\t\tscrollTop: 0,\r\n\t\t\tstyle: {\r\n\t\t\t\tcontentH: 0,\r\n\t\t\t\titemH: 0\r\n\t\t\t},\r\n\t\t\tsocketOpen: false,\r\n\t\t\tsocket: undefined,\r\n\t\t\tinputMode: 'text',\r\n\t\t\timgPath: '../../static/record.png',\r\n\t\t\trecorderManager: undefined,\r\n\t\t\trecordStart: undefined,\r\n\t\t\trecordEnd: undefined,\r\n\t\t\taudioManager: undefined,\r\n\t\t\tchatStyle: 'chat-send',\r\n\t\t\tisShow: false,\r\n\t\t\texpressions: expressions.slice(0, 59),\r\n\t\t\ttouchT: 0,\r\n\t\t\ttouchE: 0\r\n\t\t};\r\n\t},\r\n\tonLoad() {\r\n\t\tconsole.log(expressions);\r\n\t\tconsole.log(this.baseUrl);\r\n\t\tthis.recorderManager = uni.getRecorderManager();\r\n\t\tthis.audioManager = uni.createInnerAudioContext();\r\n\t\tthis.recorderManager.onStop(res => {\r\n\t\t\tconsole.log('recorder stop' + JSON.stringify(res));\r\n\t\t\tconsole.log(res.tempFilePath);\r\n\t\t\tconsole.log(res.duration);\r\n\t\t\tif (res.duration < 1000) {\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ticon: 'error',\r\n\t\t\t\t\ttitle: '讲话时间太短'\r\n\t\t\t\t});\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tuniCloud.uploadFile({\r\n\t\t\t\tcloudPath: `${new Date().getTime()}.mp3`,\r\n\t\t\t\tfilePath: res.tempFilePath,\r\n\t\t\t\tonUploadProgress: progressEvent => {\r\n\t\t\t\t\tconsole.log(progressEvent);\r\n\t\t\t\t\tvar percentCompleted = Math.round((progressEvent.loaded * 100) / progressEvent.total);\r\n\t\t\t\t\tconsole.log(percentCompleted);\r\n\t\t\t\t},\r\n\t\t\t\tsuccess: r => {\r\n\t\t\t\t\tconsole.log('Upload successfully');\r\n\t\t\t\t\tconst uploadUrl = r.fileID;\r\n\t\t\t\t\tconsole.log(uploadUrl);\r\n\t\t\t\t\tlet onemsg = {\r\n\t\t\t\t\t\ttype: 'record',\r\n\t\t\t\t\t\tduration: res.duration,\r\n\t\t\t\t\t\trecord: uploadUrl,\r\n\t\t\t\t\t\tnewmsg: Math.round(res.duration / 1000),\r\n\t\t\t\t\t\tusername: this.name,\r\n\t\t\t\t\t\tavatar: this.avatar,\r\n\t\t\t\t\t\tcreatedAt: new Date().getTime(),\r\n\t\t\t\t\t\tsender: this.openid\r\n\t\t\t\t\t};\r\n\t\t\t\t\tlet data = {\r\n\t\t\t\t\t\trecord: uploadUrl,\r\n\t\t\t\t\t\tmsg: Math.round(res.duration / 1000),\r\n\t\t\t\t\t\tcreatedAt: new Date().getTime(),\r\n\t\t\t\t\t\tsender: this.openid\r\n\t\t\t\t\t};\r\n\t\t\t\t\tthis.chatlist.push(onemsg);\r\n\t\t\t\t\tconsole.log(this.chatlist);\r\n\t\t\t\t\tthis.newmsg = ''; //清空\r\n\t\t\t\t\t// this.socket.emit('message', data);\r\n\t\t\t\t\tconsole.log(this.socketOpen);\r\n\t\t\t\t\tif (this.socketOpen) {\r\n\t\t\t\t\t\tuni.sendSocketMessage({\r\n\t\t\t\t\t\t\tdata: JSON.stringify({\r\n\t\t\t\t\t\t\t\tevent: 'message',\r\n\t\t\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\t\t\troomid: 'chatroom',\r\n\t\t\t\t\t\t\t\t\tcontent: {\r\n\t\t\t\t\t\t\t\t\t\ttype: 'record',\r\n\t\t\t\t\t\t\t\t\t\t...data\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}),\r\n\t\t\t\t\t\t\tsuccess: res => {\r\n\t\t\t\t\t\t\t\tconsole.log(res);\r\n\t\t\t\t\t\t\t\tthis.pageToBottom();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t//do some tips\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tconsole.log(this.recordEnd - this.recordStart);\r\n\t\t});\r\n\t\tconst userinfo = uni.getStorageSync('userinfo');\r\n\t\tif (!userinfo) {\r\n\t\t\tuni.showToast({\r\n\t\t\t\ticon: 'error',\r\n\t\t\t\ttitle: '网络错误'\r\n\t\t\t});\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst { username, avatar } = JSON.parse(userinfo);\r\n\t\tthis.name = username;\r\n\t\tthis.avatar = avatar;\r\n\t\t// uni.getStorage({\r\n\t\t// \tkey:'openid',\r\n\t\t// \tsuccess(res) {\r\n\t\t// \t\tconsole.log(res);\r\n\t\t// \t\tconsole.log(res.data);\r\n\t\t// \t},\r\n\t\t// \tfail(err) {\r\n\t\t// \t\tconsole.log(err);\r\n\t\t// \t}\r\n\t\t// })\r\n\t\t// 创建WebSocket连接\r\n\t\tconst socketTask = uni.connectSocket({\r\n\t\t\turl: 'ws://101.34.19.31:4000/chat', // 你的WebSocket服务器地址和端口\r\n\t\t\tsuccess(res) {\r\n\t\t\t\tconsole.log('Success');\r\n\t\t\t},\r\n\t\t\tfail(err) {\r\n\t\t\t\tconsole.log('Error');\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// 监听WebSocket连接成功事件\r\n\t\tsocketTask.onOpen(() => {\r\n\t\t\tconsole.log('WebSocket连接成功');\r\n\t\t\tthis.socketOpen = true;\r\n\t\t\tthis.socket = socketTask;\r\n\t\t\tthis.openid = uni.getStorageSync('openid');\r\n\t\t\tuni.sendSocketMessage({\r\n\t\t\t\tdata: JSON.stringify({\r\n\t\t\t\t\tevent: 'message',\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\tcontent: {\r\n\t\t\t\t\t\t\ttype: 'pre',\r\n\t\t\t\t\t\t\tmsg: this.openid\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t});\r\n\t\t});\r\n\t\t// 监听WebSocket接收到服务器的消息事件\r\n\t\tsocketTask.onMessage(res => {\r\n\t\t\tconst content = JSON.parse(res.data);\r\n\t\t\tconsole.log('收到服务器的消息：', content);\r\n\t\t\tif (content.code) {\r\n\t\t\t\tthis.userlist = content.users;\r\n\t\t\t\tconst preChatlist = content.message.map(value => {\r\n\t\t\t\t\tconst chat = {\r\n\t\t\t\t\t\tavatar: value['avatar'],\r\n\t\t\t\t\t\tusername: value['username'],\r\n\t\t\t\t\t\t...value['content']\r\n\t\t\t\t\t};\r\n\t\t\t\t\tchat['newmsg'] = chat['msg'];\r\n\t\t\t\t\tdelete chat['msg'];\r\n\t\t\t\t\treturn chat;\r\n\t\t\t\t});\r\n\t\t\t\tlet cacheChatlist = JSON.parse(uni.getStorageSync('chatlist') || '[]');\r\n\t\t\t\tcacheChatlist = cacheChatlist.map((v)=>{\r\n\t\t\t\t\tif(v.record){\r\n\t\t\t\t\t\tdelete v.showMenu\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn v\r\n\t\t\t\t})\r\n\t\t\t\tthis.chatlist = cacheChatlist.concat(preChatlist).sort((a, b) => a.createdAt - b.createdAt);\r\n\t\t\t} else {\r\n\t\t\t\tconst msg = content.content;\r\n\t\t\t\tconst sender = this.userlist.find(value => value.openid === msg.sender);\r\n\t\t\t\tmsg['newmsg'] = msg['msg'];\r\n\t\t\t\tdelete msg['msg'];\r\n\t\t\t\tif (sender) {\r\n\t\t\t\t\tmsg['avatar'] = sender.avatar;\r\n\t\t\t\t\tmsg['username'] = sender.username;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tmsg['avatar'] = '/static/images/f.png';\r\n\t\t\t\t\tmsg['username'] = '潘展弛';\r\n\t\t\t\t}\r\n\t\t\t\tconsole.log(msg);\r\n\t\t\t\tthis.chatlist.push(msg);\r\n\t\t\t}\r\n\t\t\t// this.chatlist.push(res.data)\r\n\t\t});\r\n\r\n\t\t// 监听WebSocket连接关闭事件\r\n\t\tsocketTask.onClose(res => {\r\n\t\t\tconsole.log('WebSocket连接关闭');\r\n\t\t\tconsole.log(this.chatlist);\r\n\t\t\tuni.setStorageSync('chatlist', JSON.stringify(this.chatlist));\r\n\t\t});\r\n\r\n\t\t// 监听WebSocket连接错误事件\r\n\t\tsocketTask.onError(res => {\r\n\t\t\tconsole.log('WebSocket连接错误');\r\n\t\t\tuni.showToast({\r\n\t\t\t\ticon: 'error',\r\n\t\t\t\ttitle: '请检查网络'\r\n\t\t\t});\r\n\t\t});\r\n\t},\r\n\tonUnload() {\r\n\t\tuni.closeSocket({\r\n\t\t\tsuccess(res) {\r\n\t\t\t\tconsole.log(res);\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\tonReady() {\r\n\t\t// 初始化参数\r\n\t\ttry {\r\n\t\t\tconst res = uni.getSystemInfoSync();\r\n\t\t\tthis.style.contentH = res.windowHeight - uni.upx2px(230);\r\n\t\t} catch (e) {\r\n\t\t\tconsole.log(e);\r\n\t\t}\r\n\t\tthis.pageToBottom(true);\r\n\t},\r\n\tmethods: {\r\n\t\ttoggleShow() {\r\n\t\t\tthis.isShow = !this.isShow;\r\n\t\t\tconsole.log(this.isShow);\r\n\t\t\tconsole.log(this.expressions);\r\n\t\t},\r\n\t\ttouchstart() {\r\n\t\t\tthis.touchT = new Date().getTime();\r\n\t\t},\r\n\t\ttouchend() {\r\n\t\t\tthis.touchE = new Date().getTime();\r\n\t\t},\r\n\t\trecordToText(index) {\r\n\t\t\tconst msg = {...this.chatlist[index]}\r\n\t\t\tconst url = msg.record;\r\n\t\t\tthis.chatlist[index].showMenu = true\r\n\t\t\tmsg.showMenu = true;\r\n\t\t\tmsg.transferText = undefined;\r\n\t\t\tif (url) {\r\n\t\t\t\tthis.request({\r\n\t\t\t\t\turl: '/user/transfer',\r\n\t\t\t\t\tmethod: 'POST',\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\turl\r\n\t\t\t\t\t}\r\n\t\t\t\t}).then(\r\n\t\t\t\t\tres => {\r\n\t\t\t\t\t\tconsole.log(res.data.result.Sentences[0].Text);\r\n\t\t\t\t\t\tmsg.transferText = res.data.result.Sentences[0].Text;\r\n\t\t\t\t\t\tthis.chatlist.splice(index,1,msg)\r\n\t\t\t\t\t},\r\n\t\t\t\t\trea => {\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ticon: 'error',\r\n\t\t\t\t\t\t\ttitle: '请检查网络'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t},\r\n\t\tchooseMedia() {\r\n\t\t\tuni.chooseMedia({\r\n\t\t\t\tcount: 9,\r\n\t\t\t\tsizeType: ['original', 'compressed'],\r\n\t\t\t\tmediaType: ['image'],\r\n\t\t\t\tsourceType: ['camera'],\r\n\t\t\t\tcamera:'front',\r\n\t\t\t\t// maxDuration: 30,\r\n\t\t\t\tsuccess: res => {\r\n\t\t\t\t\tconsole.log('Choose successfully');\r\n\t\t\t\t\tconsole.log(res);\r\n\t\t\t\t\tuniCloud.uploadFile({\r\n\t\t\t\t\t\tcloudPath: `${new Date().getTime()}.png`,\r\n\t\t\t\t\t\tfilePath: res.tempFiles[0].tempFilePath,\r\n\t\t\t\t\t\tsuccess: r => {\r\n\t\t\t\t\t\t\tconst uploadUrl = r.fileID;\r\n\t\t\t\t\t\t\tconsole.log('Upload successfully');\r\n\t\t\t\t\t\t\tconsole.log(uploadUrl);\r\n\t\t\t\t\t\t\tlet onemsg = {\r\n\t\t\t\t\t\t\t\ttype: res.type,\r\n\t\t\t\t\t\t\t\tnewmsg: uploadUrl,\r\n\t\t\t\t\t\t\t\tusername: this.name,\r\n\t\t\t\t\t\t\t\tavatar: this.avatar,\r\n\t\t\t\t\t\t\t\tcreatedAt: new Date().getTime(),\r\n\t\t\t\t\t\t\t\tsender: this.openid\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\tlet data = {\r\n\t\t\t\t\t\t\t\ttype: res.type,\r\n\t\t\t\t\t\t\t\tmsg: uploadUrl,\r\n\t\t\t\t\t\t\t\tcreatedAt: new Date().getTime(),\r\n\t\t\t\t\t\t\t\tsender: this.openid\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\tthis.chatlist.push(onemsg);\r\n\t\t\t\t\t\t\tconsole.log(this.chatlist);\r\n\t\t\t\t\t\t\tthis.newmsg = ''; //清空\r\n\t\t\t\t\t\t\tconsole.log(this.socketOpen);\r\n\t\t\t\t\t\t\tif (this.socketOpen) {\r\n\t\t\t\t\t\t\t\tuni.sendSocketMessage({\r\n\t\t\t\t\t\t\t\t\tdata: JSON.stringify({\r\n\t\t\t\t\t\t\t\t\t\tevent: 'message',\r\n\t\t\t\t\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\t\t\t\t\troomid: 'chatroom',\r\n\t\t\t\t\t\t\t\t\t\t\tcontent: data\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}),\r\n\t\t\t\t\t\t\t\t\tsuccess: res => {\r\n\t\t\t\t\t\t\t\t\t\tconsole.log(res);\r\n\t\t\t\t\t\t\t\t\t\tthis.pageToBottom();\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t//do some tips\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tpickerEmoji(emoji) {\r\n\t\t\tthis.newmsg += emoji.title;\r\n\t\t},\r\n\t\tpageToBottom(isfirst = false) {\r\n\t\t\tlet q = uni.createSelectorQuery().in(this);\r\n\t\t\tlet itemH = q.selectAll('.chat-item');\r\n\t\t\tthis.$nextTick(() => {\r\n\t\t\t\titemH\r\n\t\t\t\t\t.fields(\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tsize: true\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tdata => {\r\n\t\t\t\t\t\t\tif (data) {\r\n\t\t\t\t\t\t\t\tif (isfirst) {\r\n\t\t\t\t\t\t\t\t\tfor (let i = 0; i < data.length; i++) {\r\n\t\t\t\t\t\t\t\t\t\tthis.style.itemH += data[i].height;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tthis.style.itemH += data[data.length - 1].height;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tthis.scrollTop = this.style.itemH > this.style.contentH ? this.style.itemH : 0;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t)\r\n\t\t\t\t\t.exec();\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t//发送消息\r\n\t\tsendMsg() {\r\n\t\t\t// if (this.newmsg.length > 0 && this.fid == '') {\r\n\t\t\tif (this.newmsg.length > 0) {\r\n\t\t\t\tlet now = new Date().getTime();\r\n\t\t\t\tlet onemsg = {\r\n\t\t\t\t\ttype: 'message',\r\n\t\t\t\t\tnewmsg: this.newmsg,\r\n\t\t\t\t\tusername: this.name,\r\n\t\t\t\t\tavatar: this.avatar,\r\n\t\t\t\t\tcreatedAt: now,\r\n\t\t\t\t\tsender: this.openid\r\n\t\t\t\t};\r\n\t\t\t\tlet data = {\r\n\t\t\t\t\tmsg: this.newmsg,\r\n\t\t\t\t\tcreatedAt: now,\r\n\t\t\t\t\tsender: this.openid\r\n\t\t\t\t};\r\n\t\t\t\tif (this.socketOpen) {\r\n\t\t\t\t\tthis.chatlist.push(onemsg);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.chatlist.push({\r\n\t\t\t\t\t\terr: true,\r\n\t\t\t\t\t\t...onemsg\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tconsole.log(this.chatlist);\r\n\t\t\t\tthis.newmsg = ''; //清空\r\n\t\t\t\t// this.socket.emit('message', data);\r\n\t\t\t\tconsole.log(this.socketOpen);\r\n\t\t\t\tif (this.socketOpen) {\r\n\t\t\t\t\tuni.sendSocketMessage({\r\n\t\t\t\t\t\tdata: JSON.stringify({\r\n\t\t\t\t\t\t\tevent: 'message',\r\n\t\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\t\troomid: 'chatroom',\r\n\t\t\t\t\t\t\t\tcontent: {\r\n\t\t\t\t\t\t\t\t\ttype: 'message',\r\n\t\t\t\t\t\t\t\t\t...data\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}),\r\n\t\t\t\t\t\tsuccess: res => {\r\n\t\t\t\t\t\t\tconsole.log(res);\r\n\t\t\t\t\t\t\tthis.pageToBottom();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tresendMsg(msg) {\r\n\t\t\tlet data = {\r\n\t\t\t\tmsg: msg.newmsg,\r\n\t\t\t\tcreatedAt: msg.createdAt,\r\n\t\t\t\tsender: msg.sender\r\n\t\t\t};\r\n\t\t\t// this.socketOpen = true\r\n\t\t\tif (this.socketOpen) {\r\n\t\t\t\tconst reMsg = this.chatlist.find(v => v.createdAt === data.createdAt);\r\n\t\t\t\t//assign to update view\r\n\t\t\t\t// Object.assign(this.chatlist.find(v=>v.createdAt === data.createdAt),reMsg)\r\n\t\t\t\t// console.log(this.chatlist.find(v=>v.createdAt === data.createdAt));\r\n\t\t\t\tuni.sendSocketMessage({\r\n\t\t\t\t\tdata: JSON.stringify({\r\n\t\t\t\t\t\tevent: 'message',\r\n\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\troomid: 'chatroom',\r\n\t\t\t\t\t\t\tcontent: {\r\n\t\t\t\t\t\t\t\ttype: 'message',\r\n\t\t\t\t\t\t\t\t...data\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tsuccess: res => {\r\n\t\t\t\t\t\tdelete reMsg['err'];\r\n\t\t\t\t\t\tconsole.log(res);\r\n\t\t\t\t\t\tthis.pageToBottom();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ticon: 'error',\r\n\t\t\t\t\ttitle: '请检查网络'\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t},\r\n\t\trecordMsg(e) {\r\n\t\t\tconsole.log(e);\r\n\t\t\tthis.recordStart = new Date().valueOf();\r\n\t\t\tthis.chatStyle = 'chat-send-press';\r\n\t\t\tthis.recorderManager.start(this.recordOption);\r\n\t\t\tconsole.log(this.recordStart);\r\n\t\t},\r\n\t\tsendRecordMsg() {\r\n\t\t\tthis.recordEnd = new Date().valueOf();\r\n\t\t\tthis.recorderManager.stop();\r\n\t\t\tthis.chatStyle = 'chat-send';\r\n\t\t},\r\n\t\tplayRecord(e) {\r\n\t\t\tconsole.log(this.touchE);\r\n\t\t\tconsole.log(this.touchT);\r\n\t\t\tif (this.touchE - this.touchT > 350) {\r\n\t\t\t\t// if(e.record){\r\n\t\t\t\t// \tthis.recordToText(e)\r\n\t\t\t\t// }\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif (e.type === 'record') {\r\n\t\t\t\tthis.audioManager.src = e.record;\r\n\t\t\t\tthis.audioManager.play();\r\n\t\t\t}\r\n\t\t},\r\n\t\tpreviewImage(url) {\r\n\t\t\tconsole.log(url);\r\n\t\t\tuni.previewImage({\r\n\t\t\t\turls: [url],\r\n\t\t\t\tcurrent: url,\r\n\t\t\t\tshowmenu: true,\r\n\t\t\t\tsuccess: res => {\r\n\t\t\t\t\tconsole.log(res);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\ttextHandler(message) {\r\n\t\t\t// message is a object\r\n\t\t\t// type consists of video、image and text\r\n\t\t\tconsole.log(message);\r\n\t\t\tconst { type, newmsg } = message;\r\n\t\t\tif (type === 'message') {\r\n\t\t\t\tif (newmsg.indexOf('[') > -1) {\r\n\t\t\t\t\t//text contains teex and emoji,extract emoji feature and process to html\r\n\t\t\t\t\tlet emojiMap = {};\r\n\t\t\t\t\texpressions.forEach(item => {\r\n\t\t\t\t\t\temojiMap[item.title] = item.url;\r\n\t\t\t\t\t});\r\n\t\t\t\t\tconsole.log(emojiMap);\r\n\t\t\t\t\tconst reg = /\\[.*?\\]/g;\r\n\t\t\t\t\tconst showMsg =\r\n\t\t\t\t\t\t'<div style=\"display: flex;align-items: center;\">' +\r\n\t\t\t\t\t\tnewmsg.replace(reg, r => (emojiMap[r] ? `<img width=\"28\" height=\"28\" src=\"${this.baseUrl + emojiMap[r]}\"/>` : r)) +\r\n\t\t\t\t\t\t'</div>';\r\n\t\t\t\t\t// const showMsg = newmsg.replace(reg, r => `<img style=\"width:68rpx;height:68rpx\" src=\"${this.baseUrl + emojiMap[r]}\"/>`);\r\n\t\t\t\t\t// const parser = new DOMParser();\r\n\t\t\t\t\t// let doc = parser.parseFromString(showMsg, 'text/html');\r\n\t\t\t\t\tconsole.log(showMsg);\r\n\t\t\t\t\treturn showMsg;\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn newmsg;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t//获取消息\r\n\t\treceiveMsg: function() {\r\n\t\t\t//获取即时信息渲染\r\n\t\t\tthis.socket.on('sendMsg', data => {\r\n\t\t\t\t// this.chatlist.push(data);\r\n\t\t\t\tthis.pageToBottom();\r\n\t\t\t});\r\n\t\t},\r\n\t\tchangeMode() {\r\n\t\t\tthis.inputMode = this.inputMode == 'text' ? 'record' : 'text';\r\n\t\t\tthis.imgPath = this.imgPath == '../../static/record.png' ? '../../static/keyboard.png' : '../../static/record.png';\r\n\t\t}\r\n\t}\r\n};\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n.main {\r\n\tpadding: 40rpx 28rpx;\r\n}\r\n.avatar {\r\n\tflex: none;\r\n\twidth: 64rpx;\r\n\theight: 64rpx;\r\n\tborder-radius: 18rpx;\r\n\tmargin: 10rpx 20rpx;\r\n\talign-self: flex-start;\r\n}\r\n.main {\r\n\t.msg {\r\n\t\tdisplay: flex;\r\n\t\talign-items: flex-end;\r\n\t\tpadding: 20rpx 0;\r\n\t\t.nr {\r\n\t\t\tdisplay: flex;\r\n\t\t\tflex-direction: column;\r\n\t\t\talign-items: flex-end;\r\n\t\t\t.newmsg {\r\n\t\t\t\tmax-width: 320rpx;\r\n\t\t\t\tpadding: 16rpx 32rpx;\r\n\t\t\t\tmin-height: 48rpx;\r\n\t\t\t\tfont-size: 28rpx;\r\n\t\t\t\tcolor: rgba(25, 29, 35, 1);\r\n\t\t\t\tline-height: 48rpx;\r\n\t\t\t\tword-break: break-word;\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t}\r\n\t\t\t.nt {\r\n\t\t\t\tpadding-top: 8rpx;\r\n\t\t\t\tfont-size: 24rpx;\r\n\t\t\t\tcolor: rgba(25, 29, 35, 0.5);\r\n\t\t\t\tline-height: 34rpx;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t.left {\r\n\t\tflex-direction: row;\r\n\t\t.newmsg {\r\n\t\t\tbackground:rgba(244,244,244,1);\r\n\t\t\tborder-radius: 24rpx 24rpx 24rpx 0px;\r\n\t\t\talign-items: center;\r\n\t\t}\r\n\t\t.nr{\r\n\t\t\talign-items: flex-start;\r\n\t\t}\r\n\t}\r\n\t.right {\r\n\t\tflex-direction: row-reverse;\r\n\t\t.newmsg {\r\n\t\t\tbackground:rgba(255,234,222,1);\r\n\t\t\tborder-radius: 24rpx 24rpx 0px 24rpx;\r\n\t\t\talign-items: center;\r\n\t\t}\r\n\t\t.nt {\r\n\t\t\tright: 132rpx;\r\n\t\t}\r\n\t}\r\n\t.center {\r\n\t\ttext-align: center;\r\n\t\t// padding: 32rpx 0 20rpx;\r\n\t\t.inner {\r\n\t\t\tfont-size: 24rpx;\r\n\t\t\tdisplay: inline-block;\r\n\t\t\tcolor: rgba(25, 29, 35, 0.5);\r\n\t\t\tline-height: 34rpx;\r\n\t\t}\r\n\t}\r\n}\r\n.transferView {\r\n\tbackground-color: #cccccc;\r\n\tposition:relative;\r\n\tmin-width:120rpx;\r\n\tmax-width: 300rpx;\r\n\tpadding: 16rpx 32rpx;\r\n\tmin-height: 48rpx;\r\n\tfont-size: 28rpx;\r\n\tcolor: rgba(25, 29, 35, 1);\r\n\tline-height: 48rpx;\r\n\tword-break: break-word;\r\n\tborder-radius: 24rpx 24rpx 24rpx 24rpx;\r\n\tdisplay: flex;\r\n\talign-items: center;\r\n}\r\n.chat-send {\r\n\tmargin: 12rpx 20rpx;\r\n\tflex: 1;\r\n\twidth: 100%;\r\n\tmin-height: 40rpx;\r\n\tbackground: rgba(242, 242, 242, 1);\r\n\tborder-radius: 24rpx;\r\n\tfont-size: 28rpx;\r\n\tcolor: rgba(25, 29, 35, 1);\r\n\tline-height: 40rpx;\r\n\tpadding: 24rpx;\r\n\ttext-align: center;\r\n}\r\n.chat-send-press {\r\n\tmargin: 12rpx 20rpx;\r\n\tflex: 1;\r\n\twidth: 100%;\r\n\tmin-height: 40rpx;\r\n\tbackground: rgba(222, 222, 222, 1);\r\n\tborder-radius: 24rpx;\r\n\tfont-size: 28rpx;\r\n\tcolor: rgba(25, 29, 35, 1);\r\n\tline-height: 40rpx;\r\n\tpadding: 24rpx 52rpx 24rpx 52rpx;\r\n\ttext-align: center;\r\n}\r\n.send {\r\n\tposition: fixed;\r\n\tz-index: 1002;\r\n\tbottom: 0;\r\n\twidth: 100%;\r\n\tborder-top: 1px solid #cccccc;\r\n\t// padding-bottom: var(--status-bar-height);\r\n\tmin-height: 100rpx;\r\n\tbackground: rgba(255, 255, 255, 0.96);\r\n\tdisplay: flex;\r\n\t.emoji-panel {\r\n\t\timage {\r\n\t\t\tmargin-top: 0;\r\n\t\t}\r\n\t}\r\n\timage {\r\n\t\twidth: 68rpx;\r\n\t\theight: 68rpx;\r\n\t\tmargin-top: 22rpx;\r\n\t\t// position: absolute;\r\n\t\t// right: 68rpx;\r\n\t\t// top: 32rpx;\r\n\t}\r\n}\r\n.modify {\r\n\tposition: fixed;\r\n\toverflow: hidden;\r\n\tleft: 0;\r\n\tbottom: -90%;\r\n\twidth: 100%;\r\n\theight: 90%;\r\n\tz-index: 1000;\r\n\tbackground: #fff;\r\n\tborder-radius: 48rpx 48rpx 0px 0px;\r\n}\r\n.u-name {\r\n\tposition: absolute;\r\n\ttop: 0;\r\n\tbackground-color: #fff;\r\n\theight: 80rpx;\r\n\ttext-align: center;\r\n\twidth: 100%;\r\n\tline-height: 80rpx;\r\n}\r\n.bg {\r\n\twidth: 100%;\r\n\theight: 100%;\r\n\tposition: fixed;\r\n\ttop: 0;\r\n\tleft: 0;\r\n\tz-index: 999;\r\n\tbackground-color: rgba(0, 0, 0, 0.4);\r\n}\r\n.emoji-panel {\r\n\t// padding: 10rpx;\r\n\tborder-radius: 4px;\r\n\tbackground-color: #ffffff;\r\n\tposition: absolute;\r\n\tdisplay: flex;\r\n\tflex-wrap: wrap;\r\n\tbottom: 100%;\r\n\t// width: calc(100% - 20rpx);\r\n\tbox-shadow: 0 0 3px #d1dbe5;\r\n\tmargin-bottom: 5px;\r\n\t// left: -40px;\r\n}\r\n.emoji-list {\r\n\tlist-style: none;\r\n\tpadding: 0;\r\n\tmargin: 0;\r\n}\r\n.emoji-list:after {\r\n\tdisplay: block;\r\n\tclear: both;\r\n\tcontent: '';\r\n}\r\n.emoji-item {\r\n\tfloat: left;\r\n\twidth: 26px;\r\n\theight: 26px;\r\n\tpadding: 2px;\r\n\tbox-sizing: content-box;\r\n\tcursor: pointer;\r\n\tborder-radius: 2px;\r\n\tuser-select: none;\r\n}\r\n</style>\n","import mod from \"-!../../../../../../Tools/HBuilderX.3.3.5.20211229.full/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../../Tools/HBuilderX.3.3.5.20211229.full/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../../Tools/HBuilderX.3.3.5.20211229.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../Tools/HBuilderX.3.3.5.20211229.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../../Tools/HBuilderX.3.3.5.20211229.full/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../../Tools/HBuilderX.3.3.5.20211229.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../../Tools/HBuilderX.3.3.5.20211229.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../../Tools/HBuilderX.3.3.5.20211229.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Tools/HBuilderX.3.3.5.20211229.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chatroom.vue?vue&type=style&index=0&id=6981a9d6&scoped=true&lang=scss&\"; export default mod; export * from \"-!../../../../../../Tools/HBuilderX.3.3.5.20211229.full/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../../Tools/HBuilderX.3.3.5.20211229.full/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../../Tools/HBuilderX.3.3.5.20211229.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../Tools/HBuilderX.3.3.5.20211229.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../../Tools/HBuilderX.3.3.5.20211229.full/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../../Tools/HBuilderX.3.3.5.20211229.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../../Tools/HBuilderX.3.3.5.20211229.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../../Tools/HBuilderX.3.3.5.20211229.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Tools/HBuilderX.3.3.5.20211229.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chatroom.vue?vue&type=style&index=0&id=6981a9d6&scoped=true&lang=scss&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1685183865150\n      var cssReload = require(\"D:/Tools/HBuilderX.3.3.5.20211229.full/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}